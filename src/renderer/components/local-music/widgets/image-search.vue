<template>
  <div class="image_searcher blurred_bg blur20 widget">
    <div class="widget_header">
      <h1 class="widget_title">Image Searcher</h1>
      <base-button
        icon="x"
        extra-class="widget_close shrink_icon circle shrink8"
        :small="true"
        @click.native="UIcontrollerToggleProperty('showImageSearcher')"
      />
    </div>
    <div class="centerContents">
      <input
        v-model="query"
        type="text"
        class="inputElem mb10 w-90"
        placeholder="Search"
        @keyup.enter="searchImage"
      />
      <base-button
        :active="true"
        :block="true"
        text="Search"
        @click.native="searchImage"
      />
    </div>
    <div v-if="searching" class="loadingArea">
      <div class="loadingIndicator" />
    </div>
    <div class="image_results scroll_y pr5 ml5 mt5">
      <img
        v-for="cover in imageResults"
        :key="cover.url"
        :src="cover.url"
        class="round5"
        @click="selectImage(cover.url)"
      />
    </div>
  </div>
</template>

<script>
import { mapMutations } from "vuex";
import { sendMessageToNode } from "@/renderer/utils";

export default {
  name: "ImageSearch",

  data() {
    return {
      query: "",
      imageResults: [],
      searching: false,
      selectedImage: "",
    };
  },
  methods: {
    ...mapMutations(["UIcontrollerToggleProperty"]),
    searchImage() {
      console.log("searching for image");
      this.imageResults = [];
      this.searching = true;
      fetch(`https://flb-server.onrender.com/search-image?query=${this.query}`)
        .then((response) => response.text())
        .then((result) => {
          console.log(result);
          this.imageResults = JSON.parse(result).slice(0, 10);
        })
        .catch((error) => console.log("error", error));
      this.searching = false;
    },
    selectImage(url) {
      this.selectedImage = url;
      sendMessageToNode("imageSearcherChoice", this.selectedImage);
    },
  },
};
</script>

<style lang="scss">
.image_searcher {
  z-index: 51;
  right: 300px;
  border: 1px solid rgba(255, 255, 255, 0.315);
  .widget_header {
    margin-bottom: 10px;
  }
  .image_results {
    max-width: 100%;
    max-height: 430px;
    border-radius: 15px;
    img {
      width: 100%;
      cursor: pointer;
      &:hover {
        transform: scale(0.9);
      }
    }
  }
}
</style>
